<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>وميض إكس - حدد موقع منشأتك</title>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<style>
body { margin:0; }
#map { width:100%; height:100vh; }
</style>
</head>

<body>

<div id="map"></div>

<script>

mapboxgl.accessToken =

const map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/streets-v11',
center: [46.65,24.75],
zoom: 12
});

let marker;

async function loadGeo() {
const s1 = await fetch("screen-1.geojson").then(r=>r.json());
const s2 = await fetch("screen-2.geojson").then(r=>r.json());
const s3 = await fetch("screen-3.geojson").then(r=>r.json());

return [
{id:"screen-1", geo:s1},
{id:"screen-2", geo:s2},
{id:"screen-3", geo:s3}
];
}

map.on('click', async (e)=>{

if(marker) marker.remove();

marker = new mapboxgl.Marker()
.setLngLat([e.lngLat.lng, e.lngLat.lat])
.addTo(map);

const screens = await loadGeo();

const point = turf.point([e.lngLat.lng, e.lngLat.lat]);

let inside=[];

screens.forEach(s=>{
if(turf.booleanPointInPolygon(point,s.geo.features[0])){
inside.push(s.id);
}
});

if(inside.length>0){
alert("أقرب شاشة تخدم منشأتك هي: "+inside[0]);
}else{
alert("أقرب شاشة لك خارج النطاق");
}

});

</script>

</body>
</html>
