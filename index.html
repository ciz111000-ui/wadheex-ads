<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wadheex Ads â€” Ù…Ù†ØµØ© ÙˆÙ…ÙŠØ¶</title>

  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <style>
    :root{
      --bg:#0b0f17;
      --panel:#0f1624;
      --panel2:#0b1220;
      --text:#e9eefb;
      --muted:#aab6d6;
      --stroke:rgba(255,255,255,.08);
      --orange:#ff6600;
      --orange2:#ff3300;
      --ok:#22c55e;
      --bad:#ef4444;
    }
    html, body { height:100%; margin:0; background:var(--bg); font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial; color:var(--text); }
    #app { position:relative; width:100%; height:100%; overflow:hidden; }
    #map { position:absolute; inset:0; }

    /* Ø´Ø±ÙŠØ· Ø£Ø¹Ù„Ù‰ */
    .topbar{
      position:absolute; top:14px; right:14px; left:14px;
      display:flex; justify-content:space-between; gap:12px;
      z-index:10; pointer-events:none;
    }
    .pill{
      pointer-events:auto;
      background:rgba(15,22,36,.85);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      color:var(--muted);
      max-width:520px;
      line-height:1.4;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    .pill b{ color:var(--text); }

    /* Ù„ÙˆØ­Ø© ÙŠÙ…ÙŠÙ† */
    .panel{
      position:absolute; top:70px; right:14px; bottom:14px;
      width:360px; max-width: calc(100% - 28px);
      background:rgba(15,22,36,.88);
      border:1px solid var(--stroke);
      backdrop-filter: blur(12px);
      border-radius:18px;
      z-index:10;
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      display:flex; flex-direction:column;
      overflow:hidden;
    }
    .panel header{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,102,0,.10), transparent);
    }
    .panel header .title{
      font-weight:800; letter-spacing:.2px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--muted);
    }
    .badge.ok{ color:var(--ok); border-color:rgba(34,197,94,.25); background:rgba(34,197,94,.08); }
    .badge.bad{ color:var(--bad); border-color:rgba(239,68,68,.25); background:rgba(239,68,68,.08); }

    .panel .content{
      padding:12px 14px;
      display:flex; flex-direction:column; gap:10px;
      overflow:auto;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .card{
      background:rgba(11,18,32,.65);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:10px;
    }
    .label{ font-size:12px; color:var(--muted); margin-bottom:6px; }
    .value{ font-size:14px; color:var(--text); min-height:18px; }

    .row{ display:flex; gap:10px; }
    .btn{
      cursor:pointer;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      width:100%;
    }
    .btn:hover{ filter:brightness(1.08); }
    .btn.orange{ background:var(--orange); border-color:rgba(255,102,0,.5); color:white; }
    .btn.ghost{ background:rgba(255,255,255,.03); }
    .btn.small{ padding:8px 10px; font-weight:700; }

    .hint{
      font-size:13px; color:var(--muted); line-height:1.5;
      border:1px dashed rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(0,0,0,.15);
    }
    .hint b{ color:var(--text); }

    /* Ø¥Ø®ÙØ§Ø¡ Ø´Ø¹Ø§Ø± mapbox controls Ø®Ù„Ù Ø§Ù„Ù„ÙˆØ­Ø© */
    .mapboxgl-ctrl-bottom-right{ right: 380px; }

    /* Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    @media (max-width: 900px){
      .panel{ width:auto; left:14px; right:14px; height: 46%; top:auto; bottom:14px; }
      .mapboxgl-ctrl-bottom-right{ right: 14px; }
      .topbar{ flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>

<body>
<div id="app">
  <div id="map"></div>

  <div class="topbar">
    <div class="pill"><b>Wadheex Ads â€” Ù…Ù†ØµØ© ÙˆÙ…ÙŠØ¶</b><br>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù†. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ‚ÙˆÙ„ Ù„Ùƒ Ø¥Ø°Ø§ Ø¯Ø§Ø®Ù„ Ù†Ø·Ø§Ù‚ Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø© Ø®Ù„Ø§Ù„ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø£Ùˆ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚.</div>
    <div class="pill" id="debugPill">ğŸŸ¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
  </div>

  <aside class="panel">
    <header>
      <div class="title">
        <div>Ù…Ù†ØµØ© Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø°Ø§ØªÙŠ â€” Wadheex Ads</div>
        <div class="badge" id="statusBadge">â€”</div>
      </div>
      <div style="margin-top:6px; font-size:12px; color:var(--muted)">Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ + ØªØ³Ø¹ÙŠØ± + Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³</div>
    </header>

    <div class="content">
      <div class="grid">
        <div class="card">
          <div class="label">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Ø©</div>
          <div class="value" id="addr">â€”</div>
        </div>
        <div class="card">
          <div class="label">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</div>
          <div class="value" id="coords">â€”</div>
        </div>

        <div class="card">
          <div class="label">Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø©</div>
          <div class="value" id="nearest">â€”</div>
        </div>
        <div class="card">
          <div class="label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</div>
          <div class="value" id="dist">â€”</div>
        </div>

        <div class="card">
          <div class="label">ØªØ³Ø¹ÙŠØ± Ù…Ø¨Ø¯Ø¦ÙŠ</div>
          <div class="value" id="price">â€”</div>
        </div>
        <div class="card">
          <div class="label">Ø§Ù„Ø­Ø§Ù„Ø©</div>
          <div class="value" id="insideTxt">â€”</div>
        </div>
      </div>

      <div class="hint">
        <b>Ø´Ø±Ø­ Ø³Ø±ÙŠØ¹:</b><br>
        Ø¥Ø°Ø§ ÙƒÙ†Øª <span style="color:var(--ok); font-weight:800">Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚</span> ØªÙ‚Ø¯Ø± ØªÙ‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©.<br>
        Ø¥Ø°Ø§ ÙƒÙ†Øª <span style="color:var(--bad); font-weight:800">Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚</span> ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø© Ù„ÙƒÙ† Ø§Ù„Ø·Ù„Ø¨ ÙŠØªÙˆÙ‚Ù Ù„ÙŠÙ† ØªÙˆØ³Ø¹ Ø§Ù„ØªØºØ·ÙŠØ©.
      </div>

      <div class="row">
        <button class="btn small" id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</button>
        <button class="btn small" id="saveBtn">Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>

      <button class="btn orange" id="waBtn">(WhatsApp) ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨</button>

      <div class="row">
        <button class="btn ghost" id="exportBtn">ØªØµØ¯ÙŠØ± (JSON)</button>
        <button class="btn ghost" id="clearBtn">Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      </div>

      <div class="card">
        <div class="label">Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Local)</div>
        <div class="value"><span id="count">0</span> Ø·Ù„Ø¨</div>
      </div>
    </div>
  </aside>
</div>

<script>
/* ==============================
   0) Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ (Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø¥Ù„Ø§ Ù„Ùˆ ØªØ¨ØºÙ‰)
================================ */
mapboxgl.accessToken = "pk.eyJ1IjoibjktN3Z2IiwiYSI6ImNtbTJubnJjMDA4OGEycXNnaXN2M21lZ3QifQ.yZPWMAgrnQxnwZZdr8kwjA";

// Ù…Ù„Ù Ø§Ù„Ù†Ø·Ø§Ù‚ (iso) â€” Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ Ø¬Ù†Ø¨ index.html
const AREA_FILE = "iso-screen-1.geojson";

// Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³ (Ø¨Ø¯ÙˆÙ† +)
const WHATSAPP_PHONE = "966583611252";

// ØªØ³Ø¹ÙŠØ± Ù…Ø¨Ø¯Ø¦ÙŠ (ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù„Ù‡)
const PRICE_INSIDE_WEEK = 2000;   // Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚
const PRICE_OUTSIDE_TEXT = "Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØºØ·ÙŠØ©";

/* ==============================
   1) Ø¹Ù†Ø§ØµØ± UI
================================ */
const elAddr = document.getElementById("addr");
const elCoords = document.getElementById("coords");
const elNearest = document.getElementById("nearest");
const elDist = document.getElementById("dist");
const elPrice = document.getElementById("price");
const elInsideTxt = document.getElementById("insideTxt");
const elBadge = document.getElementById("statusBadge");
const elCount = document.getElementById("count");
const elDebug = document.getElementById("debugPill");

function setBadge(text, ok=null){
  elBadge.textContent = text;
  elBadge.classList.remove("ok","bad");
  if(ok===true) elBadge.classList.add("ok");
  if(ok===false) elBadge.classList.add("bad");
}

function setDebug(text){
  elDebug.textContent = text;
}

/* ==============================
   2) Ø§Ù„Ø®Ø±ÙŠØ·Ø©
================================ */
  // âœ… Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø´Ø§Ø´Ø© (Ø­Ø· Ù‡Ù†Ø§ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)
const SCREEN1 = { name: "Screen-1", lng: 46.611060, lat: 24.776352 };
const map = new mapboxgl.Map({
  container: "map",
  style: "mapbox://styles/mapbox/streets-v11",
  center: [46.67, 24.74],
  zoom: 11
});
map.addControl(new mapboxgl.NavigationControl(), "bottom-right");

let marker = null;
let areaFeature = null;   // Feature Polygon/MultiPolygon Ù„Ù„ÙØ­Øµ
let areaFC = null;        // FeatureCollection Ù„Ù„Ø±Ø³Ù…
let insideArea = false;
let lastClick = null;

/* ==============================
   3) ØªØ·Ø¨ÙŠØ¹ GeoJSON (ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ORS)
      ORS Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ ÙŠØ­Ø· Feature Point Ø£ÙˆÙ„Ø§Ù‹
================================ */
function isPolyType(t){ return t === "Polygon" || t === "MultiPolygon"; }

async function loadArea(){
  const res = await fetch(AREA_FILE, { cache: "no-store" });
  if(!res.ok) throw new Error("Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£Ù‚Ø±Ø£ Ù…Ù„Ù Ø§Ù„Ù†Ø·Ø§Ù‚. ØªØ£ÙƒØ¯ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø±: " + AREA_FILE);

  const geo = await res.json();
  let feature = null;

  if(geo.type === "FeatureCollection"){
    feature = (geo.features || []).find(f => f && f.geometry && isPolyType(f.geometry.type));
  } else if(geo.type === "Feature") {
    if(geo.geometry && isPolyType(geo.geometry.type)) feature = geo;
  } else {
    throw new Error("ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ù„Ø§Ø²Ù… FeatureCollection Ø£Ùˆ Feature.");
  }

  if(!feature) throw new Error("Ù…Ù„Ù Ø§Ù„Ù†Ø·Ø§Ù‚ Ù…Ø§ ÙÙŠÙ‡ Polygon/MultiPolygon (Ù…Ù…ÙƒÙ† ÙÙŠÙ‡ Point ÙÙ‚Ø·).");

  areaFeature = feature;
  areaFC = { type:"FeatureCollection", features:[feature] };
  return areaFC;
}

/* ==============================
   4) Ø±Ø³Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ + ØªÙ‚Ø±ÙŠØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ
================================ */
map.on("load", async ()=>{
  try{
    setDebug("ğŸŸ¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø·Ø§Ù‚â€¦");

    const fc = await loadArea();

    map.addSource("screen-area", { type:"geojson", data: fc });

    map.addLayer({
      id:"screen-fill",
      type:"fill",
      source:"screen-area",
      paint:{ "fill-color":"#ff6600", "fill-opacity":0.28 }
    });

    map.addLayer({
      id:"screen-outline",
      type:"line",
      source:"screen-area",
      paint:{ "line-color":"#ff3300", "line-width":2 }
    });

    // ØªÙ‚Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù†Ø·Ø§Ù‚
    const bbox = turf.bbox(fc);
    map.fitBounds(bbox, { padding: 60, duration: 700 });

 const bbox = turf.bbox(fc);
map.fitBounds(bbox, { padding: 60, duration: 700 });

setDebug("ğŸŸ¢ Ø¬Ø§Ù‡Ø² â€” Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©");
setBadge("Ø¬Ø§Ù‡Ø²", true);
  }catch(err){
    console.error(err);
    setDebug("ğŸ”´ Ø®Ø·Ø£: " + err.message);
    setBadge("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„", false);
    alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø·Ø§Ù‚:\n" + err.message + "\n\nØ§ÙØªØ­ iso-screen-1.geojson ÙˆØªØ£ÙƒØ¯ ÙÙŠÙ‡ Polygon/MultiPolygon.");
  }
});

/* ==============================
   5) Ø£Ø¯ÙˆØ§Øª: Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© + Ø¹Ù†ÙˆØ§Ù† ØªÙ‚Ø±ÙŠØ¨ÙŠ (Ø¨Ø¯ÙˆÙ† API Ø¥Ø¶Ø§ÙÙŠ)
================================ */
function kmBetween(lng1, lat1, lng2, lat2){
  const p1 = turf.point([lng1,lat1]);
  const p2 = turf.point([lng2,lat2]);
  return turf.distance(p1,p2,{units:"kilometers"});
}

// (Ø¨Ø³ÙŠØ·Ø©) Ø§Ø³Ù… "Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø©" â€” Ø­Ø§Ù„ÙŠØ§Ù‹ Ø´Ø§Ø´Ø© 1 (ØªÙˆØ³Ø¹Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
function nearestScreenTo(lng, lat){
  // Ù…Ø±ÙƒØ² Ø§Ù„Ù†Ø·Ø§Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¶Ù„Ø¹
  const center = turf.center(areaFC).geometry.coordinates; // [lng,lat]
  const km = kmBetween(lng, lat, center[0], center[1]);
  return { name:"Screen-1", km, center };
}

/* ==============================
   6) ÙƒÙ„ÙŠÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
================================ */
map.on("click", (e)=>{
  if(!areaFeature){
    alert("Ø§Ù„Ù†Ø·Ø§Ù‚ Ù…Ø§ Ø§Ù†Ø­Ù…Ù‘Ù„ Ù„Ù„Ø­ÙŠÙ†â€¦");
    return;
  }

  lastClick = { lng: e.lngLat.lng, lat: e.lngLat.lat };

  if(marker) marker.remove();
  marker = new mapboxgl.Marker().setLngLat(e.lngLat).addTo(map);

  const pt = turf.point([lastClick.lng, lastClick.lat]);
  insideArea = turf.booleanPointInPolygon(pt, areaFeature);

  // Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø© + Ù…Ø³Ø§ÙØ©
  const near = nearestScreenTo(lastClick.lng, lastClick.lat);

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  elCoords.textContent = `${lastClick.lat.toFixed(6)}, ${lastClick.lng.toFixed(6)}`;
  elNearest.textContent = near.name;
  elDist.textContent = `${near.km.toFixed(2)} ÙƒÙ…`;

  if(insideArea){
    elInsideTxt.innerHTML = `<span style="color:var(--ok); font-weight:800">Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚ âœ…</span>`;
    elPrice.textContent = `${PRICE_INSIDE_WEEK} Ø±ÙŠØ§Ù„ / Ø£Ø³Ø¨ÙˆØ¹`;
    setBadge("Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚", true);
  }else{
    elInsideTxt.innerHTML = `<span style="color:var(--bad); font-weight:800">Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ âŒ</span>`;
    elPrice.textContent = PRICE_OUTSIDE_TEXT;
    setBadge("Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚", false);
  }

  // Ø¹Ù†ÙˆØ§Ù† Ù…Ø¨Ø³Ø· (Ø¨Ø¯ÙˆÙ† geocoding Ù…Ø¯ÙÙˆØ¹) â€” Ù†ÙƒØªØ¨ "Ø§Ù„Ø±ÙŠØ§Ø¶"
  elAddr.textContent = "Ø§Ù„Ø±ÙŠØ§Ø¶ (ØªØ­Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ)";

});

/* ==============================
   7) Ø­ÙØ¸ / ØªØµØ¯ÙŠØ± / ÙˆØ§ØªØ³
================================ */
const STORAGE_KEY = "wadheex_requests_v1";

function getSaved(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
  catch{ return []; }
}
function setSaved(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  elCount.textContent = arr.length;
}
setSaved(getSaved());

document.getElementById("copyBtn").onclick = async ()=>{
  if(!lastClick) return alert("Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
  const txt = `${lastClick.lat}, ${lastClick.lng}`;
  try{
    await navigator.clipboard.writeText(txt);
    alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…");
  }catch{
    prompt("Ø§Ù†Ø³Ø®Ù‡Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§:", txt);
  }
};

document.getElementById("saveBtn").onclick = ()=>{
  if(!lastClick) return alert("Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
  const arr = getSaved();
  arr.push({
    ts: new Date().toISOString(),
    lat: lastClick.lat,
    lng: lastClick.lng,
    inside: insideArea,
    price: insideArea ? PRICE_INSIDE_WEEK : null
  });
  setSaved(arr);
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ âœ…");
};

document.getElementById("exportBtn").onclick = ()=>{
  const arr = getSaved();
  const blob = new Blob([JSON.stringify(arr,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "wadheex-requests.json";
  a.click();
  URL.revokeObjectURL(url);
};

document.getElementById("clearBtn").onclick = ()=>{
  if(confirm("ØªØ¨ØºÙ‰ ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ")){
    setSaved([]);
  }
};

document.getElementById("waBtn").onclick = ()=>{
  if(!lastClick) return alert("Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ Ø£ÙˆÙ„Ø§Ù‹");

  if(!insideArea){
    return alert("Ø£Ù†Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØºØ·ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹.\nØ¨ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø´Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø·Ù„Ø¨ ÙŠØªÙˆÙ‚Ù Ù„ÙŠÙ† ØªÙˆØ³Ø¹ Ø§Ù„ØªØºØ·ÙŠØ©.");
  }

  const msg =
`Ø·Ù„Ø¨ Ø¥Ø¹Ù„Ø§Ù† â€” Wadheex Ads
Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ø±ÙŠØ§Ø¶
Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${lastClick.lat.toFixed(6)}, ${lastClick.lng.toFixed(6)}
Ø§Ù„Ø­Ø§Ù„Ø©: Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚ âœ…
Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ: ${PRICE_INSIDE_WEEK} Ø±ÙŠØ§Ù„/Ø£Ø³Ø¨ÙˆØ¹
Ù…Ù„Ø§Ø­Ø¸Ø©: Ø£Ø±ÙÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© + Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† + Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·`;

  const wa = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(msg)}`;
  window.open(wa, "_blank");
};
</script>
</body>
</html>
