<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WAMMED X — منصة الحجز الذكية</title>

<!-- Mapbox -->
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<!-- Geocoder -->
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>

<!-- Turf -->
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: radial-gradient(circle at top, #0f1c2e, #07101c 60%);
  font-family: "Cairo", sans-serif;
  color: #F2F6FA;
  overflow: hidden;
}

/* شريط علوي */
.topbar {
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 26px;
  z-index: 1000;
  background: rgba(10,20,35,0.65);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #4DA3FF, #1E5A8A);
  color: #0B1E33;
  font-weight: 900;
  font-size: 22px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 12px rgba(77,163,255,0.5);
}

.logo-text {
  font-size: 22px;
  font-weight: 800;
}

.logo-text .x {
  color: #4DA3FF;
  text-shadow: 0 0 8px #4DA3FF;
}

.top-actions {
  display: flex;
  gap: 10px;
}

.top-btn {
  padding: 7px 14px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-size: 13px;
  background: rgba(255,255,255,0.08);
  color: #F2F6FA;
}

.top-btn.highlight {
  background: linear-gradient(135deg, #1E5A8A, #4DA3FF);
  box-shadow: 0 0 10px rgba(77,163,255,0.5);
}

/* الخريطة */
#map {
  position: absolute;
  top: 70px;
  bottom: 0;
  right: 0;
  left: 0;
}

/* زر القائمة */
.open-sidebar {
  position: fixed;
  top: 90px;
  right: 20px;
  background: linear-gradient(135deg, #1E5A8A, #4DA3FF);
  color: #F2F6FA;
  border: none;
  padding: 12px 20px;
  border-radius: 10px;
  cursor: pointer;
  z-index: 900;
  box-shadow: 0 0 12px rgba(77,163,255,0.4);
}

/* اللوحة الجانبية */
.sidebar {
  position: fixed;
  top: 70px;
  right: -420px;
  width: 380px;
  height: calc(100% - 70px);
  padding: 22px;
  overflow-y: auto;
  transition: 0.35s;
  z-index: 999;
  background: rgba(10,20,35,0.7);
  backdrop-filter: blur(18px);
  border-left: 1px solid rgba(255,255,255,0.08);
}

.sidebar.open {
  right: 0;
}

.close-sidebar {
  background: none;
  border: none;
  color: #4DA3FF;
  font-size: 30px;
  cursor: pointer;
  float: left;
}

/* البطاقات */
.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 14px;
  padding: 18px;
  margin-bottom: 18px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25);
}

.card-title {
  margin: 0 0 12px 0;
  font-size: 17px;
  font-weight: 700;
}

/* الحقول */
label {
  font-size: 13px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin: 6px 0 14px 0;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.05);
  color: #F2F6FA;
  font-size: 14px;
}

/* الأزرار */
.primary-btn {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #1E5A8A, #4DA3FF);
  border: none;
  border-radius: 10px;
  color: #F2F6FA;
  font-size: 16px;
  cursor: pointer;
  margin-top: 10px;
  box-shadow: 0 0 12px rgba(77,163,255,0.4);
}

.primary-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.secondary-btn {
  width: 100%;
  padding: 10px;
  background: rgba(255,255,255,0.08);
  border: none;
  border-radius: 10px;
  color: #F2F6FA;
  cursor: pointer;
  margin-bottom: 10px;
}

.secondary-btn.danger {
  background: rgba(255,0,0,0.25);
}

/* السعر */
.price-box {
  background: rgba(255,255,255,0.05);
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
  margin-top: 10px;
  text-align: center;
  font-size: 16px;
}

/* النطاق */
.range-info {
  margin-top: 10px;
  font-size: 14px;
  color: #8FA3B8;
}

/* التبديل */
.toggle {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Geocoder */
.mapboxgl-ctrl-geocoder {
  width: 100%;
}

/* Popup */
.mapboxgl-popup-content {
  background: rgba(10,20,35,0.9);
  color: #F2F6FA;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}
.mapboxgl-popup-tip {
  border-top-color: rgba(10,20,35,0.9) !important;
}
</style>
</head>

<body>

<header class="topbar">
  <div class="brand">
    <div class="logo-icon">W</div>
    <span class="logo-text">WAMMED <span class="x">X</span></span>
  </div>
  <div class="top-actions">
    <button class="top-btn">تسجيل الدخول</button>
    <button class="top-btn highlight">إنشاء حساب</button>
  </div>
</header>

<div id="map"></div>

<button id="openSidebar" class="open-sidebar">القائمة</button>

<aside id="sidebar" class="sidebar">
  <button id="closeSidebar" class="close-sidebar">×</button>

  <!-- البحث -->
  <section class="card">
    <h3 class="card-title">بحث عن موقع</h3>
    <div id="geocoder"></div>
  </section>

  <!-- تفاصيل الشاشة -->
  <section class="card" id="screenDetails" style="display:none">
    <h3 class="card-title">الشاشة المختارة</h3>
    <div id="screenInfo"></div>
  </section>

  <!-- الحجز -->
  <section class="card" id="bookingSection" style="display:none">
    <h3 class="card-title">إتمام الحجز</h3>

    <label>اسم المنشأة</label>
    <input id="orgName" type="text" placeholder="مثال: مطعم الواحة">

    <label>نوع المنشأة</label>
    <select id="orgType">
      <option value="">اختر النوع</option>
      <option>مطعم</option>
      <option>مقهى</option>
      <option>متجر</option>
      <option>شركة</option>
      <option>مؤسسة</option>
    </select>

    <label>عدد الشاشات</label>
    <input id="screenCount" type="number" min="1" value="1">

    <label>تاريخ ووقت البداية</label>
    <input id="startDate" type="datetime-local">

    <label>مدة العرض بالدقائق</label>
    <input id="durationMinutes" type="number" min="10" value="60">

    <label>هل تحتاج تصميم إعلان؟</label>
    <select id="needDesign">
      <option value="no">لا</option>
      <option value="yes">نعم (+800 ريال)</option>
    </select>

    <label>رقم التواصل</label>
    <input id="phone" type="text" placeholder="05xxxxxxxx">

    <div class="price-box" id="priceBox">السعر: 0 ريال</div>

    <button id="bookBtn" class="primary-btn" disabled>إتمام الحجز</button>
  </section>

  <!-- النطاق -->
  <section class="card">
    <h3 class="card-title">النطاق</h3>
    <button id="rangeBtn" class="secondary-btn">تحديد نطاق</button>
    <button id="clearRange" class="secondary-btn danger">مسح النطاق</button>
    <div id="rangeInfo" class="range-info">لم يتم تحديد نطاق بعد</div>
  </section>

  <!-- الخريطة الحرارية -->
  <section class="card">
    <h3 class="card-title">الخريطة الحرارية</h3>
    <label class="toggle">
      <input type="checkbox" id="toggleHeat">
      <span>تفعيل الخريطة الحرارية (تجريبي)</span>
    </label>
  </section>
</aside>

<script>
// توكن Mapbox حقك
mapboxgl.accessToken = "pk.eyJ1IjoibjktN3Z2IiwiYSI6ImNtbTJubnJjMDA4OGEycXNnaXN2M21lZ3QifQ.yZPWMAgrnQxnwZZdr8kwjA";

// إنشاء الخريطة
const map = new mapboxgl.Map({
  container: "map",
  style: "mapbox://styles/mapbox/dark-v11",
  center: [46.6753, 24.7136],
  zoom: 11
});

// عناصر الواجهة
const sidebar = document.getElementById("sidebar");
const openSidebarBtn = document.getElementById("openSidebar");
const closeSidebarBtn = document.getElementById("closeSidebar");
const screenDetails = document.getElementById("screenDetails");
const screenInfo = document.getElementById("screenInfo");
const bookingSection = document.getElementById("bookingSection");
const bookBtn = document.getElementById("bookBtn");
const priceBox = document.getElementById("priceBox");

let selectedScreen = null;

// فتح وإغلاق القائمة
openSidebarBtn.onclick = () => sidebar.classList.add("open");
closeSidebarBtn.onclick = () => sidebar.classList.remove("open");

// Geocoder
const geocoder = new MapboxGeocoder({
  accessToken: mapboxgl.accessToken,
  mapboxgl: mapboxgl,
  marker: false,
  placeholder: "ابحث عن موقع..."
});
document.getElementById("geocoder").appendChild(geocoder.onAdd(map));

let searchMarker = null;
geocoder.on("result", (e) => {
  const coords = e.result.center;
  if (searchMarker) searchMarker.remove();
  searchMarker = new mapboxgl.Marker({ color: "#4DA3FF" })
    .setLngLat(coords)
    .addTo(map);
  map.flyTo({ center: coords, zoom: 14 });
});

// شاشات تجريبية
const screens = [
  { id: 1, name: "شاشة العليا", coords: [46.675, 24.72], price: 150 },
  { id: 2, name: "شاشة النخيل", coords: [46.68, 24.75], price: 180 },
  { id: 3, name: "شاشة الملز", coords: [46.72, 24.68], price: 130 }
];

// عرض الشاشات على الخريطة
screens.forEach(screen => {
  const marker = new mapboxgl.Marker({ color: "#1E5A8A" })
    .setLngLat(screen.coords)
    .addTo(map);

  const popupHtml = `
    <div style="font-size:13px">
      <div><strong>${screen.name}</strong></div>
      <div>السعر الأساسي: ${screen.price} ريال</div>
      <button id="select-${screen.id}" style="
        margin-top:8px;
        padding:6px 10px;
        background:#1E5A8A;
        color:#F2F6FA;
        border:none;
        border-radius:4px;
        cursor:pointer;
        font-size:12px;
      ">اختيار الشاشة</button>
    </div>
  `;

  const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(popupHtml);
  marker.setPopup(popup);

  marker.getElement().addEventListener("click", () => {
    setTimeout(() => {
      const btn = document.getElementById(`select-${screen.id}`);
      if (btn) btn.onclick = () => selectScreen(screen);
    }, 50);
  });
});

// اختيار شاشة
function selectScreen(screen) {
  selectedScreen = screen;
  sidebar.classList.add("open");
  screenDetails.style.display = "block";
  bookingSection.style.display = "block";

  screenInfo.innerHTML = `
    <div><strong>الاسم:</strong> ${screen.name}</div>
    <div><strong>السعر الأساسي:</strong> ${screen.price} ريال</div>
  `;

  updatePrice();
}

// حساب السعر
function updatePrice() {
  if (!selectedScreen) return;
  let price = selectedScreen.price;
  const count = Number(document.getElementById("screenCount").value || 1);
  const needDesign = document.getElementById("needDesign").value;

  price *= count;
  if (needDesign === "yes") price += 800;

  priceBox.innerHTML = `السعر: ${price} ريال`;
  bookBtn.disabled = false;
}

document.getElementById("screenCount").oninput = updatePrice;
document.getElementById("needDesign").onchange = updatePrice;

// إتمام الحجز (تجريبي)
bookBtn.onclick = () => {
  if (!selectedScreen) return;
  const orgName = document.getElementById("orgName").value || "منشأة بدون اسم";
  alert("تم إرسال طلب الحجز على شاشة: " + selectedScreen.name + "\nللمنشأة: " + orgName);
};

// النطاق
document.getElementById("rangeBtn").onclick = () => {
  alert("اضغط على الخريطة لتحديد مركز النطاق");
  map.once("click", (e) => {
    const center = [e.lngLat.lng, e.lngLat.lat];
    const circle = turf.circle(center, 1.5, { steps: 64, units: "kilometers" });

    if (map.getSource("rangeCircle")) {
      map.getSource("rangeCircle").setData(circle);
    } else {
      map.addSource("rangeCircle", {
        type: "geojson",
        data: circle
      });
      map.addLayer({
        id: "rangeCircle",
        type: "fill",
        source: "rangeCircle",
        paint: {
          "fill-color": "#4DA3FF",
          "fill-opacity": 0.25
        }
      });
    }

    document.getElementById("rangeInfo").innerHTML = "تم تحديد نطاق 1.5 كم";
  });
};

document.getElementById("clearRange").onclick = () => {
  if (map.getLayer("rangeCircle")) map.removeLayer("rangeCircle");
  if (map.getSource("rangeCircle")) map.removeSource("rangeCircle");
  document.getElementById("rangeInfo").innerHTML = "لم يتم تحديد نطاق بعد";
};

// الخريطة الحرارية (تجريبي)
document.getElementById("toggleHeat").onchange = function () {
  if (this.checked) {
    alert("تم تفعيل الخريطة الحرارية (تجريبي)");
  } else {
    alert("تم إيقاف الخريطة الحرارية");
  }
};
</script>

</body>
</html>
