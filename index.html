// عناصر التحكم باللوحة
const panel = document.getElementById('panel');
const panelToggle = document.getElementById('panelToggle');
const closeBtn = document.getElementById('closeBtn');
const panelBody = document.getElementById('panelBody');

// فتح/إغلاق اللوحة مع تحديث aria-hidden
function openPanel() {
  panel.classList.add('open');
  panel.setAttribute('aria-hidden', 'false');
  // اجعل التركيز داخل اللوحة لسهولة الوصول
  panelBody.focus && panelBody.focus();
}
function closePanel() {
  panel.classList.remove('open');
  panel.setAttribute('aria-hidden', 'true');
  // إعادة التركيز لزر الفتح
  panelToggle.focus && panelToggle.focus();
}

// ربط الأزرار
panelToggle.addEventListener('click', (e) => {
  e.stopPropagation();
  if (panel.classList.contains('open')) closePanel();
  else openPanel();
});

closeBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  closePanel();
});

// إغلاق اللوحة عند النقر خارجها (على الخريطة)
map.on && map.on('click', () => {
  if (panel.classList.contains('open')) closePanel();
});

// إغلاق بالـ Escape لتحسين الوصول
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && panel.classList.contains('open')) {
    closePanel();
  }
});

// منع تمرير الصفحة الخلفية عند سحب داخل اللوحة على الموبايل
panelBody.addEventListener && panelBody.addEventListener('touchstart', (e) => {
  e.stopPropagation();
}, { passive: true });
