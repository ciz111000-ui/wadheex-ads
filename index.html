<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wadheex X – Stable Pro</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<style>
:root{
  --bg:#0b0b15;
  --glass:rgba(15,15,25,.6);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#fff;font-family:system-ui}

.header{
  height:70px;
  background:#0b0b15;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 24px;
  border-bottom:1px solid rgba(255,255,255,.08);
  position:sticky; top:0; z-index:20;
}
.logo svg{
  filter:drop-shadow(0 0 10px rgba(0,200,255,.6));
}
.start-btn{
  padding:10px 18px;
  background:linear-gradient(90deg,#00c6ff,#0072ff);
  border:none;color:#fff;border-radius:8px;cursor:pointer;
}

.map-wrap{position:relative;height:calc(100vh - 70px)}
#map{position:absolute;inset:0}

.panel{
  position:absolute; top:0; right:0;
  width:380px; height:100%;
  background:var(--glass);
  backdrop-filter:blur(18px);
  border-left:1px solid rgba(255,255,255,.08);
  padding:22px;
  z-index:10;
}
.panel h3{margin:0 0 12px}
.info{margin:8px 0}
.status{margin:10px 0; font-weight:bold}
.panel input, .panel select{
  width:100%; padding:10px; margin:6px 0;
  background:#0f0f18; border:1px solid #222;
  color:#fff; border-radius:6px;
}
.panel button{
  width:100%; padding:12px; margin-top:8px;
  background:linear-gradient(90deg,#8a2be2,#b26cff);
  border:none; color:#fff; border-radius:8px; cursor:pointer;
}
.panel button:disabled{opacity:.4}
</style>
</head>
<body>

<header class="header">
  <div class="logo">
    <svg viewBox="0 0 200 80" width="150">
      <defs>
        <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#00c6ff"/>
          <stop offset="100%" stop-color="#0072ff"/>
        </linearGradient>
      </defs>
      <text x="10" y="55" font-size="50" font-weight="bold"
            fill="url(#grad)" style="letter-spacing:-5px">W</text>
      <text x="70" y="55" font-size="50" font-weight="bold"
            fill="#00e0ff">X</text>
    </svg>
  </div>
  <button class="start-btn" onclick="scrollToMap()">ابدأ الحجز</button>
</header>

<section class="map-wrap" id="mapSection">
  <div id="map"></div>

  <div class="panel" id="panel">
    <h3>طلب إعلان (أسبوع)</h3>

    <div class="info" id="screenName">اختر موقع على الخريطة</div>
    <div class="info" id="duration"></div>
    <div class="info" id="price"></div>
    <div class="status" id="status"></div>

    <input id="bizName" placeholder="اسم المنشأة"/>

    <label>تاريخ بداية الإعلان</label>
    <input id="startDate" type="date"/>

    <label>وقت تشغيل الإعلان</label>
    <div style="display:flex; gap:6px;">
      <input id="startTime" type="time" style="flex:1;"/>
      <select id="ampm" style="width:80px;">
        <option value="AM">AM</option>
        <option value="PM">PM</option>
      </select>
    </div>

    <button id="bookBtn" disabled onclick="confirmBooking()">تأكيد الحجز</button>
  </div>
</section>

<script>
mapboxgl.accessToken="pk.eyJ1IjoibjktN3Z2IiwiYSI6ImNtbTJubnJjMDA4OGEycXNnaXN2M21lZ3QifQ.yZPWMAgrnQxnwZZdr8kwjA";

const map=new mapboxgl.Map({
  container:"map",
  style:"mapbox://styles/mapbox/dark-v11",
  center:[46.67,24.75],
  zoom:11
});

map.addControl(new mapboxgl.NavigationControl());

const MAX_KM=8;

const screens=[
 { name:"Screen A – الياسمين", coords:[46.67,24.74], color:"#ff3b3b"},
 { name:"Screen B – النرجس",  coords:[46.63,24.79], color:"#2b8cff"},
 { name:"Screen C – الملقا",   coords:[46.70,24.78], color:"#a855f7"}
];

let selected=null;
let circleIds=[];

map.on("load",()=>{
  screens.forEach((screen,i)=>{
    new mapboxgl.Marker({color:screen.color})
      .setLngLat(screen.coords).addTo(map);

    const circle=turf.circle(screen.coords,MAX_KM,{steps:80,units:"kilometers"});
    const id="circle-"+i;
    circleIds.push(id);

    map.addSource(id,{type:"geojson",data:circle});
    map.addLayer({
      id:id,
      type:"fill",
      source:id,
      paint:{
        "fill-color":screen.color,
        "fill-opacity":0.12
      }
    });
  });
});

map.on("click",(e)=>{
  const point=[e.lngLat.lng,e.lngLat.lat];

  let inside=[];
  screens.forEach((screen,i)=>{
    const d=turf.distance(
      turf.point(point),
      turf.point(screen.coords),
      {units:"kilometers"}
    );
    if(d<=MAX_KM){
      inside.push({screen,index:i,distance:d});
    }
  });

  const status=document.getElementById("status");
  const btn=document.getElementById("bookBtn");

  if(inside.length===0){
    status.innerText="❌ خارج نطاق 10 دقائق";
    btn.disabled=true;
    selected=null;
    return;
  }

  inside.sort((a,b)=>a.distance-b.distance);
  const chosen=inside[0];
  selected=chosen;

  let price=
    chosen.distance<=2?4000:
    chosen.distance<=5?3000:2000;

  document.getElementById("screenName").innerText=chosen.screen.name;
  document.getElementById("duration").innerText="وقت الوصول التقريبي: "+((chosen.distance/8)*10).toFixed(1)+" دقيقة";
  document.getElementById("price").innerText="السعر: "+price+" ريال";
  status.innerText="✅ داخل نطاق 10 دقائق";
  btn.disabled=false;
});

function confirmBooking(){
  if(!selected) return;

  const name=document.getElementById("bizName").value;
  const date=document.getElementById("startDate").value;
  const time=document.getElementById("startTime").value;
  const ampm=document.getElementById("ampm").value;

  if(!name || !date || !time){
    alert("الرجاء تعبئة جميع الحقول");
    return;
  }

  alert(
    "تم استلام طلبك\n\n" +
    "اسم المنشأة: " + name + "\n" +
    "الشاشة: " + selected.screen.name + "\n" +
    "تاريخ البدء: " + date + "\n" +
    "وقت التشغيل: " + time + " " + ampm
  );
}
</script>

</body>
</html>
